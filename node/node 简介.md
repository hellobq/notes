# node 简介

基于 chrome V8 引擎的 javascript 服务端运行环境。

## node 的主要特点

轻量、高效

事件驱动：通过监听事件状态的变化，来执行相关操作。比如：node 读文件，文件读取完成/未找到文件/文件读取错误都会触发对应状态，然后调用相关回调。

异步 I/O：针对 I/O 采用不阻塞操作。当线程遇到 I/O 操作时，不会等待 I/O 处理完成、拿到数据，而只是将 I/O 请求告知操作系统，继续执行下面的代码。当操作系统完成 I/O 操作后，以事件的形式通知执行 I/O 操作的线程，线程就会在空闲时处理这个事件。

## node 作用

做中间层：接口转发、权限控制、缓存代理等。

开发实用工具：例如webpack、gulp 实用工具库。

包管理工具：node 自带的 npm 包管理工具，能直接安装使用第三方包。

## node 基本原理

![node 基本原理](img/node基本原理.png)

> Chrome V8 解释并执行 JavaScript 代码。

> libuv 由事件循环和线程池组成，负责所有 I/O 任务的分发与执行。

> Node.js Bindings 层将 Chrome V8 暴露的 C/C++ 接口转成 JavaScript Api，并且结合这些 Api 编写了 Node.js 标准库。


## node 能解决传统服务器什么问题？

主要是并发连接数上。

对于像 `java`、`php`、`ASP.NET` 等服务端语言中，会为每一个客户端连接创建一个新的线程，每个线程大概消耗 2M 左右的内存。所以对于一个 8G 内存的服务器，理论上只能支持同时连接 40000 个用户，想要支持更多并发用户？就要增加服务器数量。这就带来的硬件开销。技术层面上，同一用户在不同终端上的请求可能被不同服务器处理，所以不同的服务器之间要共享所有资源。

Node 不使用上述的客户端-服务器连接方式，并不为每个客户端的连接创建一个新的线程，而是为每个客户端的连接触发一个 Node 内部事件。

## node 实现高性能服务器的原因？

因为 node 是基于 V8Javascript 引擎。它是由 google 公司实用 C++ 开发的一种高性能的 Javascript 引擎，不仅应用在浏览器 chrome 中，Node 也将其用在服务器中，并且为其提供了许多附加的具有不同用途的 API，例如：Buffer、Stream类等。

## node 适合开发的应用

应用程序需要处理大量并发的输入输出，并在客户端发出响应之前，程序内部不需要进行处理非常复杂的业务逻辑。即 node 适合 I/O 密集型而不是计算密集型业务。

> 计算密集型任务的特点是要进行大量的计算，消耗CPU资源，比如计算圆周率、对视频进行高清解码等等，全靠CPU的运算能力。这种计算密集型任务虽然也可以用多任务完成，但是任务越多，花在任务切换的时间就越多，CPU执行任务的效率就越低，所以，要最高效地利用CPU，计算密集型任务同时进行的数量应当等于CPU的核心数。

> 计算密集型任务由于主要消耗CPU资源，因此，代码运行效率至关重要。Python这样的脚本语言运行效率很低，完全不适合计算密集型任务。对于计算密集型任务，最好用C语言编写。

> IO密集型，涉及到网络、磁盘IO的任务都是IO密集型任务，这类任务的特点是CPU消耗很少，任务的大部分时间都在等待IO操作完成（因为IO的速度远远低于CPU和内存的速度）。对于IO密集型任务，任务越多，CPU效率越高，但也有一个限度。常见的大部分任务都是IO密集型任务，比如Web应用。

> IO密集型任务执行期间，99%的时间都花在IO上，花在CPU上的时间很少，因此，用运行速度极快的C语言替换用Python这样运行速度极低的脚本语言，完全无法提升运行效率。对于IO密集型任务，最合适的语言就是开发效率最高（代码量最少）的语言，脚本语言是首选，C语言最差。
